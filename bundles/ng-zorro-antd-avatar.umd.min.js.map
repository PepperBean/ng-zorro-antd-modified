{"version":3,"sources":["ng://ng-zorro-antd/avatar/nz-avatar.component.ts","ng://ng-zorro-antd/avatar/nz-avatar.module.ts"],"names":["NzAvatarComponent","prototype","setClass","classMap","_a","prefixCls","sizeMap","nzSize","nzShape","nzIcon","hasSrc","updateHostClassService","updateHostClass","el","cd","detectChanges","imgError","this","hasIcon","hasText","nzText","notifyCalc","setSizeStyle","ngOnChanges","changes","hasOwnProperty","currentValue","oldAPIIcon","indexOf","nzSrc","calcStringSize","childrenWidth","textEl","nativeElement","offsetWidth","avatarWidth","getBoundingClientRect","width","scale","textStyles","transform","Object","assign","lineHeight","_this","platform","isBrowser","setTimeout","renderer","setStyle","Component","args","selector","exportAs","template","providers","NzUpdateHostClassService","preserveWhitespaces","changeDetection","ChangeDetectionStrategy","OnPush","encapsulation","ViewEncapsulation","None","ElementRef","ChangeDetectorRef","Renderer2","Platform","Input","ViewChild","elementRef","large","small","NgModule","declarations","exports","imports","CommonModule","NzIconModule","NzAvatarModule"],"mappings":"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","sourcesContent":["/**\r\n * @license\r\n * Copyright Alibaba.com All Rights Reserved.\r\n *\r\n * Use of this source code is governed by an MIT-style license that can be\r\n * found in the LICENSE file at https://github.com/NG-ZORRO/ng-zorro-antd/blob/master/LICENSE\r\n */\r\n\r\nimport { Platform } from '@angular/cdk/platform';\r\nimport {\r\n  ChangeDetectionStrategy,\r\n  ChangeDetectorRef,\r\n  Component,\r\n  ElementRef,\r\n  Input,\r\n  OnChanges,\r\n  Renderer2,\r\n  SimpleChanges,\r\n  ViewChild,\r\n  ViewEncapsulation\r\n} from '@angular/core';\r\n\r\nimport { NzSizeLDSType, NzSizeMap, NzUpdateHostClassService } from 'ng-zorro-antd/core';\r\n\r\nexport type NzAvatarShape = 'square' | 'circle';\r\nexport type NzAvatarSize = NzSizeLDSType | number;\r\n\r\nexport interface NzAvatarSizeMap {\r\n  [size: string]: string;\r\n}\r\n\r\n@Component({\r\n  selector: 'nz-avatar',\r\n  exportAs: 'nzAvatar',\r\n  templateUrl: './nz-avatar.component.html',\r\n  providers: [NzUpdateHostClassService],\r\n  preserveWhitespaces: false,\r\n  changeDetection: ChangeDetectionStrategy.OnPush,\r\n  encapsulation: ViewEncapsulation.None\r\n})\r\nexport class NzAvatarComponent implements OnChanges {\r\n  @Input() nzShape: NzAvatarShape = 'circle';\r\n  @Input() nzSize: NzAvatarSize = 'default';\r\n  @Input() nzText: string;\r\n  @Input() nzSrc: string;\r\n  @Input() nzIcon: string;\r\n\r\n  oldAPIIcon = true; // Make the user defined icon compatible to old API. Should be removed in 2.0.\r\n  hasText: boolean = false;\r\n  hasSrc: boolean = true;\r\n  hasIcon: boolean = false;\r\n  textStyles: {};\r\n\r\n  @ViewChild('textEl') textEl: ElementRef;\r\n\r\n  private el: HTMLElement = this.elementRef.nativeElement;\r\n  private prefixCls = 'ant-avatar';\r\n  private sizeMap: NzSizeMap = { large: 'lg', small: 'sm' };\r\n\r\n  constructor(\r\n    private elementRef: ElementRef,\r\n    private cd: ChangeDetectorRef,\r\n    private updateHostClassService: NzUpdateHostClassService,\r\n    private renderer: Renderer2,\r\n    private platform: Platform\r\n  ) {}\r\n\r\n  setClass(): this {\r\n    const classMap = {\r\n      [this.prefixCls]: true,\r\n      [`${this.prefixCls}-${this.sizeMap[this.nzSize]}`]: this.sizeMap[this.nzSize],\r\n      [`${this.prefixCls}-${this.nzShape}`]: this.nzShape,\r\n      [`${this.prefixCls}-icon`]: this.nzIcon,\r\n      [`${this.prefixCls}-image`]: this.hasSrc // downgrade after image error\r\n    };\r\n    this.updateHostClassService.updateHostClass(this.el, classMap);\r\n    this.cd.detectChanges();\r\n    return this;\r\n  }\r\n\r\n  imgError(): void {\r\n    this.hasSrc = false;\r\n    this.hasIcon = false;\r\n    this.hasText = false;\r\n    if (this.nzIcon) {\r\n      this.hasIcon = true;\r\n    } else if (this.nzText) {\r\n      this.hasText = true;\r\n    }\r\n    this.setClass().notifyCalc();\r\n    this.setSizeStyle();\r\n  }\r\n\r\n  ngOnChanges(changes: SimpleChanges): void {\r\n    if (changes.hasOwnProperty('nzIcon') && changes.nzIcon.currentValue) {\r\n      this.oldAPIIcon = changes.nzIcon.currentValue.indexOf('anticon') > -1;\r\n    }\r\n    this.hasText = !this.nzSrc && !!this.nzText;\r\n    this.hasIcon = !this.nzSrc && !!this.nzIcon;\r\n    this.hasSrc = !!this.nzSrc;\r\n\r\n    this.setClass().notifyCalc();\r\n    this.setSizeStyle();\r\n  }\r\n\r\n  private calcStringSize(): void {\r\n    if (!this.hasText) {\r\n      return;\r\n    }\r\n\r\n    const childrenWidth = this.textEl.nativeElement.offsetWidth;\r\n    const avatarWidth = this.el.getBoundingClientRect().width;\r\n    const scale = avatarWidth - 8 < childrenWidth ? (avatarWidth - 8) / childrenWidth : 1;\r\n    this.textStyles = {\r\n      transform: `scale(${scale}) translateX(-50%)`\r\n    };\r\n    if (typeof this.nzSize === 'number') {\r\n      Object.assign(this.textStyles, {\r\n        lineHeight: `${this.nzSize}px`\r\n      });\r\n    }\r\n    this.cd.detectChanges();\r\n  }\r\n\r\n  private notifyCalc(): this {\r\n    // If use ngAfterViewChecked, always demands more computations, so......\r\n    if (this.platform.isBrowser) {\r\n      setTimeout(() => {\r\n        this.calcStringSize();\r\n      });\r\n    }\r\n    return this;\r\n  }\r\n\r\n  private setSizeStyle(): void {\r\n    if (typeof this.nzSize === 'string') {\r\n      return;\r\n    }\r\n    this.renderer.setStyle(this.el, 'width', `${this.nzSize}px`);\r\n    this.renderer.setStyle(this.el, 'height', `${this.nzSize}px`);\r\n    this.renderer.setStyle(this.el, 'line-height', `${this.nzSize}px`);\r\n    if (this.hasIcon) {\r\n      this.renderer.setStyle(this.el, 'font-size', `${this.nzSize / 2}px`);\r\n    }\r\n  }\r\n}\r\n","/**\r\n * @license\r\n * Copyright Alibaba.com All Rights Reserved.\r\n *\r\n * Use of this source code is governed by an MIT-style license that can be\r\n * found in the LICENSE file at https://github.com/NG-ZORRO/ng-zorro-antd/blob/master/LICENSE\r\n */\r\n\r\nimport { CommonModule } from '@angular/common';\r\nimport { NgModule } from '@angular/core';\r\nimport { NzIconModule } from 'ng-zorro-antd/icon';\r\n\r\nimport { NzAvatarComponent } from './nz-avatar.component';\r\n\r\n@NgModule({\r\n  declarations: [NzAvatarComponent],\r\n  exports: [NzAvatarComponent],\r\n  imports: [CommonModule, NzIconModule]\r\n})\r\nexport class NzAvatarModule {}\r\n"]}